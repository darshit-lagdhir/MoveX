<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoveX DFD - Level 2 (Manage Access)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        :root {
            --vp-yellow: #fff9c4;
            --vp-process-bg: #fff59d;
            --vp-process-header: #fbc02d;
            --vp-datastore-gray: #bdbdbd;
            --vp-border: #000000;
            --text-main: #000000;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            color: var(--text-main);
            padding: 2rem;
        }

        .layout {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #eee;
            padding-bottom: 1rem;
        }

        .title-group h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .nav-links {
            display: flex;
            gap: 1rem;
        }

        .nav-links a {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-decoration: none;
            color: #333;
            font-size: 0.9rem;
            background: #f5f5f5;
        }

        .nav-links a.active {
            background: var(--vp-process-header);
            border-color: var(--vp-process-header);
            color: #000;
            font-weight: 600;
        }

        .canvas {
            border: 1px solid #ddd;
            padding: 4rem;
            min-height: 800px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
            background-color: #fcfcfc;
        }

        .sidebar-legend {
            position: fixed;
            left: 2rem;
            top: 10rem;
            width: 200px;
            border: 1px solid #ddd;
            padding: 1rem;
            background: #fff;
            font-size: 0.8rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .shape {
            width: 30px;
            height: 20px;
            border: 1px solid #000;
        }

        .process-shape {
            border-radius: 6px;
            background: var(--vp-process-bg);
        }

        .entity-shape {
            background: var(--vp-yellow);
        }

        .datastore-shape {
            background: var(--vp-yellow);
            border-left: 8px solid var(--vp-datastore-gray);
        }

        /* Mermaid Overrides */
        .mermaid {
            background: transparent;
        }
    </style>
</head>

<body>
    <div class="layout">
        <header>
            <div class="title-group">
                <p style="font-size: 0.8rem; color: #666; text-transform: uppercase;">MoveX | Visual Paradigm Style</p>
                <h1>Manage Access - Level 2 (Decomposition of 1.0)</h1>
            </div>
            <nav class="nav-links">
                <a href="index.html">Overview</a>
                <a href="level0.html">Level 0</a>
                <a href="level1.html">Level 1</a>
                <a href="level2.html" class="active">Level 2</a>
                <a href="level3.html">Level 3</a>
                <a href="level4.html">Level 4</a>
                <a href="level5.html">Level 5</a>
            </nav>
        </header>

        <div class="canvas">
            <div class="mermaid">
                graph TD
                %% Entities
                U([Any Platform User])

                %% Data Stores
                D1[[D1 <br /> Users DB]]
                D4[[D4 <br /> Sessions DB]]

                %% Processes
                P11((1.1 <br /> Verify Bcrypt))
                P12((1.2 <br /> Gen Session))
                P13((1.3 <br /> Set Cookie))
                P14((1.4 <br /> Sign JWT))
                P15((1.5 <br /> Auth Guard))

                %% Flows
                U -- "UN/PW" --> P11
                P11 -- "Salted Lookups" --> D1
                P11 -- "Valid flag" --> P12

                P12 -- "Store SID" --> D4
                P12 -- "SID Token" --> P13
                P12 -- "User Claims" --> P14

                P13 -- "movex.sid (HttpOnly)" --> U
                P14 -- "Bearer JWT" --> U

                U -- "Action Request" --> P15
                P15 -- "Check Active SID" --> D4
                P15 -- "Check Permission" --> D1
                P15 -- "Allow/Deny" --> U

                %% Styling
                style P11 fill:#fff59d,stroke:#000,stroke-width:2px;
                style P12 fill:#fff59d,stroke:#000,stroke-width:2px;
                style P13 fill:#fff59d,stroke:#000,stroke-width:2px;
                style P14 fill:#fff59d,stroke:#000,stroke-width:2px;
                style P15 fill:#fff59d,stroke:#000,stroke-width:2px;

                style U fill:#fff9c4,stroke:#000,stroke-width:1px;
                style D1 fill:#fff9c4,stroke:#000,stroke-width:1px;
                style D4 fill:#fff9c4,stroke:#000,stroke-width:1px;

                linkStyle default stroke:#000,stroke-width:1px;
            </div>
        </div>

        <div class="sidebar-legend">
            <p style="font-weight: 600; margin-bottom: 1rem;">DFD Notation</p>
            <div class="legend-item">
                <div class="shape entity-shape"></div> Entity
            </div>
            <div class="legend-item">
                <div class="shape process-shape"></div> Process
            </div>
            <div class="legend-item">
                <div class="shape datastore-shape"></div> Data Store
            </div>
        </div>

        <footer>
            MoveX System Documentation - Data Flow Diagram Level 2 (Process 1.0)
        </footer>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#fff9c4',
                edgeColor: '#000000',
                fontFamily: 'Inter',
                fontSize: '14px'
            }
        });
    </script>
</body>

</html>